name: crypto-streaming-analytics
prefect-version: 3.4.8

build: null
push: null

pull:
  - prefect.deployments.steps.git_clone:
      repository: https://github.com/Pawan0426/crypto-streaming-analytics.git
      branch: main
      access_token: '{{ prefect.blocks.secret.deployment-hourly-supabase-etl-crypto-etl-supabase-repo-token }}'

  - prefect.deployments.steps.run_shell_script:
      script: |
        set -e
        echo "Installing Python dependencies..."
        if [ -f requirements.txt ]; then
          echo "Found requirements.txt, installing dependencies..."
          python -m pip install -r requirements.txt
        else
          echo "requirements.txt not found, installing basic dependencies..."
          python -m pip install requests pandas pyarrow sqlalchemy python-dotenv psycopg2-binary prefect
        fi
        echo "Dependencies installed successfully!"

deployments:
  - name: Hourly Supabase ETL
    entrypoint: orchestration/prefect_etl_flow.py:crypto_etl_supabase
    parameters: {}
    work_pool:
      name: default
    schedules:
      - cron: "0 * * * *"
        active: true
